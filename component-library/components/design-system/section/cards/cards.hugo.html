{{ $heading := .heading }}
{{ $styles := .settings.styles }}
{{ $colSpan := 8 }}
{{ $itemCount := "" }}
{{ $items := .items }}

<div class="row gx-4 gx-xxl-5 mb-n5">
  {{ range .items }}

    {{ $src := .image }}

    {{- if not site.Params.env_bookshop_live -}}
      {{ $image := "" }}
      {{/*  Get the image, either from its remote or local source  */}}
      {{ if hasPrefix $src "http"}}
        {{ $image = resources.GetRemote .image }}
      {{ else }}
        {{ $image = resources.Get .image }}
      {{ end }}
    
      {{/* Resize images and add them to a variable  */}}
      {{ if and $image (ne $image.MediaType.SubType "svg") }}
        {{ $src = ($image.Fill ("960x640 center webp")).RelPermalink }}
      {{ end }}

      {{ $itemCount = $items | len }}

      {{ if eq $itemCount 2 }}
        {{ $colSpan = "12" }}
      {{ else if eq $itemCount 1 }}
        {{ $colSpan = "18 mx-xl-auto" }}
      {{ end }}
    {{- end -}}

    <div class="col-24 col-lg-12 col-xl-{{ $colSpan }} mb-5">
      <div class="h-100 wvu-b-subtle wvu-b-shadow wvu-b-border">
        <div class="position-relative">                    
          {{ if .image }}
            <div class="ratio ratio-3x2">
              <img leading="lazy" class="object-fit-cover object-position-center" src="{{ $src }}" alt="{{ .alt_text }}" />
            </div>
          {{ end }}
        </div> 
        <div class="position-relative p-5">
          {{ if not $heading }}
            <h2 class="wvu-b-display-heading h2 mb-3"><span class="wvu-b-font-adjust">{{ .title }}</span></h2>
          {{ else }}
            <h3 class="wvu-b-display-heading h2 mb-3"><span class="wvu-b-font-adjust">{{ .title }}</span></h3>
          {{ end }}
          <p class="mb-3">{{ .text | markdownify }}</p>
          {{ with .ctas }}
            <div>
              {{ range . }}
                <a class="btn wvu-b-btn mb-1" href="{{ .url }}">{{ .text }}{{ with .icon }} <span class="fa-regular fa-{{ . }}"></span>{{ end }}</a>
              {{ end }}
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  {{ end }}
</div>